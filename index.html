

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>NetBuffer &mdash; NetBuffer 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="#" class="icon icon-home"> NetBuffer
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">NetBuffer</a><ul>
<li><a class="reference internal" href="#module-netbuffer.abm.models.buffering">API</a><ul>
<li><a class="reference internal" href="#contents">Contents</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#indices-and-tables">Indices and tables</a></li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">NetBuffer</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>NetBuffer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="netbuffer">
<h1>NetBuffer<a class="headerlink" href="#netbuffer" title="Permalink to this headline">¶</a></h1>
<p>NetBuffer is a tool to perform network based queries and aggregations
on land use data.  NetBuffer is implemented in the
<a class="reference external" href="https://github.com/activitysim">ActivitySim</a> framework.</p>
<div class="section" id="module-netbuffer.abm.models.buffering">
<span id="api"></span><h2>API<a class="headerlink" href="#module-netbuffer.abm.models.buffering" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="netbuffer.abm.models.buffering.buffer_parcels">
<code class="descclassname">netbuffer.abm.models.buffering.</code><code class="descname">buffer_parcels</code><span class="sig-paren">(</span><em>settings</em>, <em>buffer_parcels_spec</em>, <em>buffer_parcels_settings</em>, <em>parcel_data</em>, <em>data_dir</em>, <em>output_dir</em>, <em>trace_parcels</em><span class="sig-paren">)</span><a class="headerlink" href="#netbuffer.abm.models.buffering.buffer_parcels" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs network buffering (using Pandana libary <a class="reference external" href="http://udst.github.io/pandana/">http://udst.github.io/pandana/</a>)
for each point in parcel file using expressions from buffer_parcels_spec.</p>
<p>The actual results depend on the expressions in buffer_parcels_spec, but this is initially
intended to replicate PSRC’s Soundcast (Daysim) parcel accessibilities.</p>
<p>Using a point file representing the centroid of a land use boundary (parcel), quanitifes
the amount of some variable within a specified distance or the distance to a variable. For
example, the total number of jobs within a half mile of each parcel or the distance to the
nearest bus stop from each parcel.</p>
</dd></dl>

<dl class="function">
<dt id="netbuffer.abm.models.buffering.create_network">
<code class="descclassname">netbuffer.abm.models.buffering.</code><code class="descname">create_network</code><span class="sig-paren">(</span><em>settings</em>, <em>create_network_settings</em>, <em>data_dir</em><span class="sig-paren">)</span><a class="headerlink" href="#netbuffer.abm.models.buffering.create_network" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a Pandana network from CSV files</p>
</dd></dl>

<span class="target" id="module-netbuffer.core.buffer"></span><dl class="function">
<dt id="netbuffer.core.buffer.buffer_variables">
<code class="descclassname">netbuffer.core.buffer.</code><code class="descname">buffer_variables</code><span class="sig-paren">(</span><em>buffer_expressions</em>, <em>parcel_df_name</em>, <em>locals_dict</em>, <em>df_alias=None</em>, <em>trace_rows=None</em><span class="sig-paren">)</span><a class="headerlink" href="#netbuffer.core.buffer.buffer_variables" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform network accessibility calculations (using Pandana libary
<a class="reference external" href="http://udst.github.io/pandana/">http://udst.github.io/pandana/</a>) on point based data (e.g. parcel
centroids) using a set of expressions from a spec in the context of
a given data table.</p>
<p>Expressions are evaluated using Python’s eval function.
Python expressions have access to variables in locals_d.
They also have access to previously assigned
targets as the assigned target name.</p>
<p>parcel_df_name is the name of the data frame in locals_dict, which represents
point data, to which all buffering and network distance measurements are
applied. In order to do this, each row (point) in parcel_df must be associated with it’s
nearest node in the Pandana network. This is achieved using the Pandana method
network.get_node_ids. The buffering operations are performed on each node in the
network, thus allowing the results to be joined to the parcel df via node_id. Only
the results that share the same nodes in the parcel_df_name data frame
are returned.</p>
<p>For example, in order to find the distance of each parcel to the nearest
bus stop, we need a data frame representing bus stop locations and their
nearest network node. Pandana then finds the distance from every node in
the network to the nearest node that represents a bus stop. Next, only
the distances for nodes that are associated with the parcel dataframe are
kept and the results are indexed to the parcel dataframe.</p>
<p>lowercase variables starting with underscore are temp variables (e.g. _local_var)
and not returned except in trace_restults</p>
<p>uppercase variables starting with underscore are temp variables (e.g. _LOCAL_SCALAR)
and not returned except in trace_assigned_locals
This is useful for defining general purpose local constants in expression file</p>
<p>Users should take care that expressions should result in
a Pandas Series (scalars will be automatically promoted to series.)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>buffer_expressions</strong> <span class="classifier-delimiter">:</span> <span class="classifier">pandas.DataFrame of target assignment expressions</span></dt>
<dd><p class="first last">target: target column names
variable: target variable to be buffered
target_df: datafram that contains the variable to be buffered.
expression: pandana, pandas or python expression to evaluate</p>
</dd>
<dt><strong>parcel_df_name: the name of the df in df_dict to which all results</strong></dt>
<dd><p class="first last">will be indexed.</p>
</dd>
<dt><strong>df_dict</strong> <span class="classifier-delimiter">:</span> <span class="classifier">dictionary of pandas.DataFrames. This must include the df</span></dt>
<dd><p class="first last">referenced by parcel_df_name. A poi_df can be used to find distances
to other points like bus stops. All poi’s should be stored in this
one df. Other dfs can be used for aggregate buffering such as
intersections_df.</p>
</dd>
<dt><strong>locals_dict</strong> <span class="classifier-delimiter">:</span> <span class="classifier">Dict</span></dt>
<dd><p class="first last">This is a dictionary of local variables that will be the environment
for an evaluation of “python” expression.</p>
</dd>
<dt><strong>trace_rows: series or array of bools to use as mask to select target rows to trace</strong></dt>
<dd></dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>variables</strong> <span class="classifier-delimiter">:</span> <span class="classifier">pandas.DataFrame</span></dt>
<dd><p class="first last">Will have the index of <cite>df</cite> and columns named by target and containing
the result of evaluating expression</p>
</dd>
<dt><strong>trace_df</strong> <span class="classifier-delimiter">:</span> <span class="classifier">pandas.DataFrame or None</span></dt>
<dd><p class="first last">a dataframe containing the eval result values for each assignment expression</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="netbuffer.core.buffer.read_buffer_spec">
<code class="descclassname">netbuffer.core.buffer.</code><code class="descname">read_buffer_spec</code><span class="sig-paren">(</span><em>fname</em>, <em>description_name='Description'</em>, <em>target_name='Target'</em>, <em>variable_name='Variable'</em>, <em>target_df_name='TargetDF'</em>, <em>expression_name='Expression'</em><span class="sig-paren">)</span><a class="headerlink" href="#netbuffer.core.buffer.read_buffer_spec" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a CSV model specification into a Pandas DataFrame or Series.</p>
<p>The CSV is expected to have columns for component descriptions
targets, and expressions,</p>
<p>The CSV is required to have a header with column names. For example:</p>
<blockquote>
<div>Description,Target,Variable, TargetDF, Expression</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>fname</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str</span></dt>
<dd><p class="first last">Name of a CSV spec file.</p>
</dd>
<dt><strong>description_name</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str, optional</span></dt>
<dd><p class="first last">Name of the column in <cite>fname</cite> that contains the component description.</p>
</dd>
<dt><strong>target_name</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str, optional</span></dt>
<dd><p class="first last">Name of the column in <cite>fname</cite> that contains the component target.</p>
</dd>
<dt><strong>variable_name</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str, optional</span></dt>
<dd><p class="first last">Name of the column in <cite>fname</cite> that contains the variable target.</p>
</dd>
<dt><strong>target_df_name</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str, optional</span></dt>
<dd><p class="first last">Name of the column in <cite>fname</cite> that contains the target dataframe.</p>
</dd>
<dt><strong>expression_name</strong> <span class="classifier-delimiter">:</span> <span class="classifier">str, optional</span></dt>
<dd><p class="first last">Name of the column in <cite>fname</cite> that contains the component expression.</p>
</dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>spec</strong> <span class="classifier-delimiter">:</span> <span class="classifier">pandas.DataFrame</span></dt>
<dd><p class="first last">dataframe with three columns: [‘description’ ‘variable’ ‘target_df’ ‘target’ ‘expression’]</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="netbuffer.core.buffer.undupe_column_names">
<code class="descclassname">netbuffer.core.buffer.</code><code class="descname">undupe_column_names</code><span class="sig-paren">(</span><em>df</em>, <em>template='{} ({})'</em><span class="sig-paren">)</span><a class="headerlink" href="#netbuffer.core.buffer.undupe_column_names" title="Permalink to this definition">¶</a></dt>
<dd><p>rename df column names so there are no duplicates (in place)</p>
<p>e.g. if there are two columns named “dog”, the second column will be reformatted to “dog (2)”</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><dl class="first docutils">
<dt><strong>df</strong> <span class="classifier-delimiter">:</span> <span class="classifier">pandas.DataFrame</span></dt>
<dd><p class="first last">dataframe whose column names should be de-duplicated</p>
</dd>
<dt><strong>template</strong> <span class="classifier-delimiter">:</span> <span class="classifier">template taking two arguments (old_name, int) to use to rename columns</span></dt>
<dd></dd>
</dl>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><dl class="first last docutils">
<dt><strong>df</strong> <span class="classifier-delimiter">:</span> <span class="classifier">pandas.DataFrame</span></dt>
<dd><p class="first last">dataframe that was renamed in place, for convenience in chaining</p>
</dd>
</dl>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<span class="target" id="module-netbuffer.abm.tables.parcels"></span><div class="section" id="contents">
<h3>Contents<a class="headerlink" href="#contents" title="Permalink to this headline">¶</a></h3>
<div class="toctree-wrapper compound">
</div>
</div>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></li>
<li><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></li>
<li><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></li>
</ul>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright contributing authors

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>